.PHONY: help install run-streamlit run-api run-both test-api docker-build docker-up docker-down docker-logs clean

help:
	@echo "ğŸŒ± GreenTech Solutions - Commandes disponibles:"
	@echo ""
	@echo "  make install          - Installer les dÃ©pendances Python"
	@echo "  make run-streamlit    - Lancer l'application Streamlit"
	@echo "  make run-api          - Lancer l'API FastAPI"
	@echo "  make run-both         - Lancer Streamlit et API en parallÃ¨le"
	@echo "  make test-api         - Tester l'API"
	@echo ""
	@echo "  make docker-build     - Construire l'image Docker"
	@echo "  make docker-up        - DÃ©marrer les conteneurs Docker"
	@echo "  make docker-down      - ArrÃªter les conteneurs Docker"
	@echo "  make docker-logs      - Voir les logs Docker"
	@echo ""
	@echo "  make clean            - Nettoyer les fichiers temporaires"

install:
	@echo "ğŸ“¦ Installation des dÃ©pendances..."
	pip install -r requirements.txt
	@echo "âœ… Installation terminÃ©e!"

run-streamlit:
	@echo "ğŸš€ Lancement de Streamlit..."
	streamlit run app.py

run-api:
	@echo "ğŸ”Œ Lancement de l'API FastAPI..."
	uvicorn api.main:app --reload --host 0.0.0.0 --port 8000

run-both:
	@echo "ğŸš€ Lancement de Streamlit et de l'API..."
	@echo "âš ï¸  Utiliser Ctrl+C pour arrÃªter"
	@make -j2 run-streamlit run-api

test-api:
	@echo "ğŸ§ª Test de l'API..."
	python test_api.py

docker-build:
	@echo "ğŸ³ Construction de l'image Docker..."
	docker-compose build
	@echo "âœ… Image construite!"

docker-up:
	@echo "ğŸ³ DÃ©marrage des conteneurs..."
	docker-compose up -d
	@echo "âœ… Conteneurs dÃ©marrÃ©s!"
	@echo "ğŸ“Š Streamlit: http://localhost:8501"
	@echo "ğŸ”Œ API: http://localhost:8000"
	@echo "ğŸ“– Docs API: http://localhost:8000/docs"

docker-down:
	@echo "ğŸ›‘ ArrÃªt des conteneurs..."
	docker-compose down
	@echo "âœ… Conteneurs arrÃªtÃ©s!"

docker-logs:
	@echo "ğŸ“‹ Logs des conteneurs..."
	docker-compose logs -f

clean:
	@echo "ğŸ§¹ Nettoyage..."
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type d -name ".pytest_cache" -exec rm -rf {} +
	@echo "âœ… Nettoyage terminÃ©!"